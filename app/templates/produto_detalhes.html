{% extends 'base.html' %}

{% block titulo %}
{{ item.nome }} - Veganza
{% endblock %}

{% block conteudo %}
<div class="container">
  <div class="product-details fade-in">
    <div class="product-image">
      <img src="{{ url_for('static', filename='img/' + (item.imagem if item.imagem else 'default.jpg')) }}" alt="{{ item.nome }}">
    </div>
    
    <div class="product-info">
      <h1 class="product-title">{{ item.nome }}</h1>
      <div class="product-meta mb-4">
        <span class="badge bg-light text-dark me-2">Código: {{ item.cod_barra }}</span>
        <span class="badge bg-success">Vegano</span>
      </div>
      
      <div class="product-price">R$ {{ item.preco }}</div>
      
      <div class="product-description">
        <h4>Descrição</h4>
        <p>{{ item.descricao }}</p>
      </div>
      
      <div class="product-actions">
        {% if current_user.email == 'admin@gmail.com' %}
          <a href="{{ url_for('page_produto') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left me-2"></i>Voltar
          </a>
          <a href="{{ url_for('editar_produto', produto_id=item.Id) }}" class="btn btn-primary">
            <i class="fas fa-edit me-2"></i>Editar
          </a>
        {% else %}
          <a href="{{ url_for('page_produto') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left me-2"></i>Voltar
          </a>
          <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#pagaModal-{{ item.Id }}">
            <i class="fas fa-shopping-cart me-2"></i>Comprar
          </button>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Modal de pagamento -->
<div class="modal fade" id="pagaModal-{{ item.Id }}" tabindex="-1" aria-labelledby="pagaModalLabel-{{ item.Id }}"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="pagaModalLabel-{{ item.Id }}">{{ item.nome }}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p><strong>Preço:</strong> R$ {{ item.preco }}</p>

        <!-- Opções de Pagamento -->
        <h6 class="mb-3"><strong>Escolha a forma de pagamento:</strong></h6>
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" name="formaPagamento-{{ item.Id }}" id="credito-{{ item.Id }}"
            value="credito">
          <label class="form-check-label" for="credito-{{ item.Id }}">
            <i class="far fa-credit-card me-2"></i>Cartão de Crédito
          </label>
        </div>
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" name="formaPagamento-{{ item.Id }}" id="debito-{{ item.Id }}"
            value="debito">
          <label class="form-check-label" for="debito-{{ item.Id }}">
            <i class="fas fa-credit-card me-2"></i>Cartão de Débito
          </label>
        </div>
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" name="formaPagamento-{{ item.Id }}" id="pix-{{ item.Id }}"
            value="pix">
          <label class="form-check-label" for="pix-{{ item.Id }}">
            <i class="fas fa-qrcode me-2"></i>Pix
          </label>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
        <button type="button" class="btn btn-primary" onclick="processarPagamento('{{ item.Id }}')">Continuar</button>
      </div>
    </div>
  </div>
</div>

<!-- Manter os outros modais existentes, apenas com pequenas melhorias visuais -->
<!-- Incluir o script JavaScript existente -->
<script>
  // Manter o JavaScript existente
  function processarPagamento(itemId) {
    const formaPagamento = document.querySelector('input[name="formaPagamento-' + itemId + '"]:checked');
    
    if (!formaPagamento) {
      alert('Por favor, selecione uma forma de pagamento.');
      return;
    }

    // Abrir o modal correspondente à forma de pagamento escolhida
    if (formaPagamento.value === 'credito') {
      const creditoModal = new bootstrap.Modal(document.getElementById('creditoModal-' + itemId));
      creditoModal.show();
    } else if (formaPagamento.value === 'debito') {
      const debitoModal = new bootstrap.Modal(document.getElementById('debitoModal-' + itemId));
      debitoModal.show();
    } else if (formaPagamento.value === 'pix') {
      const pixModal = new bootstrap.Modal(document.getElementById('pixModal-' + itemId));
      pixModal.show();
    }
  }
  
  // Manter o restante do JavaScript existente
</script>
{% endblock %}
