{% extends 'base.html' %}

{% block titulo %}
Perfil de {{ current_user.usuario }} - Veganza
{% endblock %}

{% block conteudo %}
<!-- Hero Section -->
<section class="profile-hero">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-lg-6">
        <h1 class="profile-title">Meu Perfil</h1>
        <p class="profile-subtitle">Gerencie suas informações pessoais e preferências</p>
      </div>
      <div class="col-lg-6 d-none d-lg-block">
        <img src="{{ url_for('static', filename='img/profile-hero.png') }}" alt="Perfil" class="img-fluid profile-hero-image">
      </div>
    </div>
  </div>
  <div class="hero-shape">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320">
      <path fill="#ffffff" fill-opacity="1" d="M0,96L48,112C96,128,192,160,288,160C384,160,480,128,576,122.7C672,117,768,139,864,149.3C960,160,1056,160,1152,138.7C1248,117,1344,75,1392,53.3L1440,32L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path>
    </svg>
  </div>
</section>

<div class="container">
  <div class="profile-main">
    <div class="row">
      <!-- Sidebar -->
      <div class="col-lg-4 mb-4 mb-lg-0">
        <div class="profile-sidebar">
          <div class="profile-avatar-container">
            <div class="profile-avatar">
              <img src="{{ url_for('static', filename='img/perfill.png') }}" alt="Avatar" class="avatar-img">
              <div class="avatar-overlay">
                <i class="fas fa-camera"></i>
              </div>
            </div>
            <h3 class="profile-name">{{ current_user.usuario }}</h3>
            <p class="profile-email">{{ current_user.email }}</p>
          </div>
          
          <div class="profile-menu">
            <a href="#" class="profile-menu-item active">
              <i class="fas fa-user-circle"></i>
              <span>Informações Pessoais</span>
            </a>
            <a href="#" class="profile-menu-item">
              <i class="fas fa-shopping-bag"></i>
              <span>Meus Pedidos</span>
            </a>
            <a href="#" class="profile-menu-item">
              <i class="fas fa-heart"></i>
              <span>Lista de Desejos</span>
            </a>
            <a href="#" class="profile-menu-item">
              <i class="fas fa-map-marker-alt"></i>
              <span>Endereços</span>
            </a>
            <a href="#" class="profile-menu-item">
              <i class="fas fa-bell"></i>
              <span>Notificações</span>
            </a>
          </div>
          
          <div class="profile-stats">
            <div class="stat-item">
              <div class="stat-value">0</div>
              <div class="stat-label">Pedidos</div>
            </div>
            <div class="stat-item">
              <div class="stat-value">0</div>
              <div class="stat-label">Avaliações</div>
            </div>
            <div class="stat-item">
              <div class="stat-value">0</div>
              <div class="stat-label">Pontos</div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Main Content -->
      <div class="col-lg-8">
        <div class="profile-content">
          <div class="content-header">
            <h2><i class="fas fa-user me-2"></i>Informações Pessoais</h2>
            <p>Atualize seus dados pessoais e senha</p>
          </div>
          
          <form method="POST" class="profile-form">
            <div class="card profile-card mb-4">
              <div class="card-body">
                <h3 class="card-title">Dados da Conta</h3>
                
                <div class="row mb-3">
                  <div class="col-md-6 mb-3 mb-md-0">
                    <label for="usuario" class="form-label">Nome de Usuário</label>
                    <div class="input-group">
                      <span class="input-group-text"><i class="fas fa-user"></i></span>
                      <input type="text" class="form-control" id="usuario" name="usuario" value="{{ current_user.usuario }}" required>
                    </div>
                  </div>
                  
                  <div class="col-md-6">
                    <label for="email" class="form-label">Email</label>
                    <div class="input-group">
                      <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                      <input type="email" class="form-control" id="email" name="email" value="{{ current_user.email }}" required>
                    </div>
                  </div>
                </div>
                
                <div class="row">
                  <div class="col-md-6 mb-3 mb-md-0">
                    <label for="nome" class="form-label">Nome Completo</label>
                    <div class="input-group">
                      <span class="input-group-text"><i class="fas fa-id-card"></i></span>
                      <input type="text" class="form-control" id="nome" name="nome" value="">
                    </div>
                  </div>
                  
                  <div class="col-md-6">
                    <label for="telefone" class="form-label">Telefone</label>
                    <div class="input-group">
                      <span class="input-group-text"><i class="fas fa-phone"></i></span>
                      <input type="tel" class="form-control" id="telefone" name="telefone" value="">
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="card profile-card mb-4">
              <div class="card-body">
                <h3 class="card-title">Alterar Senha</h3>
                
                <div class="mb-3">
                  <label for="senha_atual" class="form-label">Senha Atual</label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-lock"></i></span>
                    <input type="password" class="form-control" id="senha_atual" name="senha_atual">
                    <button class="btn btn-outline-secondary toggle-password" type="button">
                      <i class="fas fa-eye"></i>
                    </button>
                  </div>
                </div>
                
                <div class="mb-3">
                  <label for="senha1" class="form-label">Nova Senha</label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-key"></i></span>
                    <input type="password" class="form-control" id="senha1" name="senha1">
                    <button class="btn btn-outline-secondary toggle-password" type="button">
                      <i class="fas fa-eye"></i>
                    </button>
                  </div>
                </div>
                
                <div class="mb-3">
                  <label for="senha2" class="form-label">Confirme a Nova Senha</label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-key"></i></span>
                    <input type="password" class="form-control" id="senha2" name="senha2">
                    <button class="btn btn-outline-secondary toggle-password" type="button">
                      <i class="fas fa-eye"></i>
                    </button>
                  </div>
                </div>
                
                <div class="password-strength">
                  <div class="strength-meter">
                    <div class="strength-meter-fill" data-strength="0"></div>
                  </div>
                  <div class="strength-text">Força da senha: <span>Fraca</span></div>
                </div>
              </div>
            </div>
            
            <div class="card profile-card mb-4">
              <div class="card-body">
                <h3 class="card-title">Preferências</h3>
                
                <div class="form-check form-switch mb-3">
                  <input class="form-check-input" type="checkbox" id="newsletter" checked>
                  <label class="form-check-label" for="newsletter">Receber newsletter com ofertas e novidades</label>
                </div>
                
                <div class="form-check form-switch mb-3">
                  <input class="form-check-input" type="checkbox" id="notificacoes" checked>
                  <label class="form-check-label" for="notificacoes">Receber notificações sobre meus pedidos</label>
                </div>
                
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="promocoes">
                  <label class="form-check-label" for="promocoes">Receber alertas de promoções</label>
                </div>
              </div>
            </div>
            
            <div class="profile-actions">
              <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteAccountModal">
                <i class="fas fa-trash-alt me-2"></i>Excluir Conta
              </button>
              <button type="submit" class="btn btn-success">
                <i class="fas fa-save me-2"></i>Salvar Alterações
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Delete Account Modal -->
<div class="modal fade" id="deleteAccountModal" tabindex="-1" aria-labelledby="deleteAccountModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteAccountModalLabel">Confirmar Exclusão</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="text-center mb-4">
          <i class="fas fa-exclamation-triangle text-danger fa-3x mb-3"></i>
          <h4>Tem certeza?</h4>
          <p>Você está prestes a excluir sua conta. Esta ação não pode ser desfeita.</p>
          <p>Todos os seus dados serão permanentemente removidos.</p>
        </div>
        <div class="mb-3">
          <label for="deleteConfirm" class="form-label">Digite "EXCLUIR" para confirmar:</label>
          <input type="text" class="form-control" id="deleteConfirm">
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-danger" id="confirmDeleteBtn" disabled>Excluir Permanentemente</button>
      </div>
    </div>
  </div>
</div>

<style>
  /* Profile Hero Section */
  .profile-hero {
    background: linear-gradient(135deg, #2ba536 0%, #1e7e34 100%);
    color: white;
    padding: 100px 0 300px;
    position: relative;
    overflow: hidden;
  }
  
  .profile-title {
    font-size: 3.5rem;
    font-weight: 700;
    margin-bottom: 1.5rem;
    text-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  }
  
  .profile-subtitle {
    font-size: 1.3rem;
    opacity: 0.9;
    max-width: 90%;
  }
  
  .profile-hero-image {
    animation: float 6s ease-in-out infinite;
    max-height: 300px;
  }
  
  .hero-shape {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    line-height: 0;
  }
  
  /* Profile Main Section */
  .profile-main {
    margin-top: -80px;
    margin-bottom: 80px;
    position: relative;
    z-index: 10;
  }
  
  /* Profile Sidebar */
  .profile-sidebar {
    background-color: white;
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    overflow: hidden;
    height: 100%;
  }
  
  .profile-avatar-container {
    background: linear-gradient(135deg, rgba(43, 165, 54, 0.1) 0%, rgba(30, 126, 52, 0.1) 100%);
    padding: 30px 20px;
    text-align: center;
    border-bottom: 1px solid #f0f0f0;
  }
  
  .profile-avatar {
    position: relative;
    width: 120px;
    height: 120px;
    margin: 0 auto 15px;
    border-radius: 50%;
    overflow: hidden;
    border: 3px solid white;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
  }
  
  .avatar-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  
  .avatar-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background-color: rgba(43, 165, 54, 0.7);
    overflow: hidden;
    width: 100%;
    height: 0;
    transition: .5s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
  }
  
  .profile-avatar:hover .avatar-overlay {
    height: 40px;
  }
  
  .avatar-overlay i {
    color: white;
    font-size: 20px;
  }
  
  .profile-name {
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 5px;
    color: var(--text-color);
  }
  
  .profile-email {
    color: var(--light-text);
    margin-bottom: 0;
    font-size: 0.9rem;
  }
  
  .profile-menu {
    padding: 20px 0;
  }
  
  .profile-menu-item {
    display: flex;
    align-items: center;
    padding: 12px 25px;
    color: var(--text-color);
    text-decoration: none;
    transition: all 0.3s ease;
    border-left: 3px solid transparent;
  }
  
  .profile-menu-item:hover, .profile-menu-item.active {
    background-color: rgba(43, 165, 54, 0.05);
    color: var(--primary-color);
    border-left-color: var(--primary-color);
  }
  
  .profile-menu-item i {
    margin-right: 15px;
    width: 20px;
    text-align: center;
  }
  
  .profile-stats {
    display: flex;
    justify-content: space-around;
    padding: 20px;
    background-color: #f9f9f9;
    border-top: 1px solid #f0f0f0;
  }
  
  .stat-item {
    text-align: center;
  }
  
  .stat-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--primary-color);
  }
  
  .stat-label {
    font-size: 0.8rem;
    color: var(--light-text);
  }
  
  /* Profile Content */
  .profile-content {
    background-color: white;
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    padding: 30px;
    height: 100%;
  }
  
  .content-header {
    margin-bottom: 30px;
    border-bottom: 1px solid #f0f0f0;
    padding-bottom: 20px;
  }
  
  .content-header h2 {
    font-size: 1.8rem;
    font-weight: 600;
    color: var(--text-color);
    margin-bottom: 10px;
  }
  
  .content-header p {
    color: var(--light-text);
    margin-bottom: 0;
  }
  
  .profile-card {
    border: none;
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    transition: all 0.3s ease;
  }
  
  .profile-card:hover {
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    transform: translateY(-5px);
  }
  
  .card-title {
    font-size: 1.3rem;
    font-weight: 600;
    color: var(--text-color);
    margin-bottom: 20px;
    display: flex;
    align-items: center;
  }
  
  .form-label {
    font-weight: 500;
    color: var(--text-color);
  }
  
  .input-group-text {
    background-color: #f8f9fa;
    border-color: #e2e2e2;
    color: var(--light-text);
  }
  
  .form-control {
    border-color: #e2e2e2;
    padding: 10px 15px;
  }
  
  .form-control:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 0.25rem rgba(43, 165, 54, 0.25);
  }
  
  .toggle-password {
    cursor: pointer;
  }
  
  .password-strength {
    margin-top: 15px;
  }
  
  .strength-meter {
    height: 5px;
    background-color: #e9ecef;
    border-radius: 5px;
    margin-bottom: 5px;
  }
  
  .strength-meter-fill {
    height: 100%;
    border-radius: 5px;
    transition: all 0.3s ease;
  }
  
  .strength-meter-fill[data-strength="0"] {
    width: 20%;
    background-color: #dc3545;
  }
  
  .strength-meter-fill[data-strength="1"] {
    width: 40%;
    background-color: #ffc107;
  }
  
  .strength-meter-fill[data-strength="2"] {
    width: 60%;
    background-color: #fd7e14;
  }
  
  .strength-meter-fill[data-strength="3"] {
    width: 80%;
    background-color: #20c997;
  }
  
  .strength-meter-fill[data-strength="4"] {
    width: 100%;
    background-color: #28a745;
  }
  
  .strength-text {
    font-size: 0.8rem;
    color: var(--light-text);
  }
  
  .form-check-input:checked {
    background-color: var(--primary-color);
    border-color: var(--primary-color);
  }
  
  .profile-actions {
    display: flex;
    justify-content: space-between;
    margin-top: 30px;
  }
  
  .btn-success {
    background-color: var(--primary-color);
    border-color: var(--primary-color);
  }
  
  .btn-success:hover {
    background-color: var(--primary-dark);
    border-color: var(--primary-dark);
  }
  
  /* Responsive */
  @media (max-width: 992px) {
    .profile-title {
      font-size: 2.5rem;
    }
    
    .profile-hero {
      padding: 80px 0 150px;
    }
    
    .profile-content {
      margin-top: 30px;
    }
  }
  
  @media (max-width: 768px) {
    .profile-title {
      font-size: 2rem;
    }
    
    .profile-actions {
      flex-direction: column;
      gap: 15px;
    }
    
    .profile-actions button {
      width: 100%;
    }
  }
  
  @keyframes float {
    0% {
      transform: translateY(0px);
    }
    50% {
      transform: translateY(-15px);
    }
    100% {
      transform: translateY(0px);
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Toggle password visibility
    const toggleButtons = document.querySelectorAll('.toggle-password');
    toggleButtons.forEach(button => {
      button.addEventListener('click', function() {
        const input = this.previousElementSibling;
        const icon = this.querySelector('i');
        
        if (input.type === 'password') {
          input.type = 'text';
          icon.classList.remove('fa-eye');
          icon.classList.add('fa-eye-slash');
        } else {
          input.type = 'password';
          icon.classList.remove('fa-eye-slash');
          icon.classList.add('fa-eye');
        }
      });
    });
    
    // Password strength meter
    const passwordInput = document.getElementById('senha1');
    const strengthMeter = document.querySelector('.strength-meter-fill');
    const strengthText = document.querySelector('.strength-text span');
    
    if (passwordInput) {
      passwordInput.addEventListener('input', function() {
        const password = this.value;
        let strength = 0;
        
        if (password.length >= 8) strength += 1;
        if (password.match(/[a-z]/) && password.match(/[A-Z]/)) strength += 1;
        if (password.match(/\d/)) strength += 1;
        if (password.match(/[^a-zA-Z\d]/)) strength += 1;
        
        strengthMeter.setAttribute('data-strength', strength);
        
        switch (strength) {
          case 0:
            strengthText.textContent = 'Fraca';
            break;
          case 1:
            strengthText.textContent = 'Fraca';
            break;
          case 2:
            strengthText.textContent = 'Média';
            break;
          case 3:
            strengthText.textContent = 'Boa';
            break;
          case 4:
            strengthText.textContent = 'Forte';
            break;
        }
      });
    }
    
    // Delete account confirmation
    const deleteConfirmInput = document.getElementById('deleteConfirm');
    const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
    
    if (deleteConfirmInput && confirmDeleteBtn) {
      deleteConfirmInput.addEventListener('input', function() {
        confirmDeleteBtn.disabled = this.value !== 'EXCLUIR';
      });
    }
  });
</script>
{% endblock %}
